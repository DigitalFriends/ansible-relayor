---

# Google DNS servers taken from:
# https://developers.google.com/speed/public-dns/docs/using
#
# OpenDNS IPs:
#  208.67.222.123
#  208.67.220.123
#  taken from: https://www.opendns.com/setupguide/
#
# CloudFlare DNS IPs:
#  1.1.1.1
#  1.0.0.1
#  2606:4700:4700::1111
#  2606:4700:4700::1001
#  taken from: https://1.1.1.1/
#
# Quad9 DNS IPs:
#  9.9.9.9
#  149.112.112.112
#  taken from: https://quad9.com/microsoft/

- name: Check if /etc/resolv.conf contains any Google, Quad9, CloudFlare or OpenDNS DNS servers (Exits only)
  command: 'grep -qE "(^nameserver 8\.8\.8\.8[[:space:]]*$|^nameserver 8\.8\.4\.4[[:space:]]*$|^nameserver 2001:4860:4860::8888[[:space:]]*$|^nameserver 2001:4860:4860::8844[[:space:]]*$|^nameserver 2001:4860:4860:0:0:0:0:8888[[:space:]]*$|^nameserver 2001:4860:4860:0:0:0:0:8888[[:space:]]*$|^nameserver 208\.67\.222\.123[[:space:]]*$|^nameserver 208\.67\.220\.123[[:space:]]*$|^nameserver 1\.1\.1\.1[[:space:]]*$|^nameserver 1\.0\.0\.1[[:space:]]*$|^nameserver 2606:4700:4700::1111[[:space:]]*$|^nameserver 2606:4700:4700::1001[[:space:]]*$|^nameserver 9\.9\.9\.9[[:space:]]*$|^nameserver 149\.112\.112\.112[[:space:]]*$)" /etc/resolv.conf'
  ignore_errors: yes
  register: dns_check

- name: Abort if Google, Quad9, CloudFlare or OpenDNS DNS servers are in use (Exits only)
  assert:
    that:
      - "dns_check.rc != 0"
    msg: "You are using Google, Quad9, CloudFlare or OpenDNS DNS servers on an exit relay, please use a local caching and DNSSEC-validating resolver instead. Aborting! Background: https://nymity.ch/dns-traffic-correlation/"
